<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slink - URL Shortener</title>
    
    <!-- Bootstrap CSS with Replit theme -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <style>
        /* Custom styles for Slink URL Shortener */
        
        /* Feather icon sizing utilities */
        .feather-sm {
            width: 16px;
            height: 16px;
        }
        
        .feather-lg {
            width: 48px;
            height: 48px;
        }
        
        /* Smooth transitions */
        .btn {
            transition: all 0.2s ease-in-out;
        }
        
        .card {
            transition: box-shadow 0.2s ease-in-out;
        }
        
        .card:hover {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        
        /* Input focus styles */
        .form-control:focus {
            border-color: var(--bs-primary);
            box-shadow: 0 0 0 0.2rem rgba(var(--bs-primary-rgb), 0.25);
        }
        
        /* Loading state for buttons */
        .btn:disabled {
            opacity: 0.7;
        }
        
        /* History item styling */
        .card-body .text-truncate {
            max-width: 100%;
        }
        
        /* Toast positioning */
        .toast-container {
            z-index: 1055;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .display-4 {
                font-size: 2rem;
            }
            
            .btn-lg {
                padding: 0.75rem 1rem;
                font-size: 1rem;
            }
            
            .card-body .d-flex.gap-2 {
                gap: 0.5rem !important;
            }
        }
        
        /* Copy button feedback */
        .copy-history-btn.copied {
            background-color: var(--bs-success);
            border-color: var(--bs-success);
            color: white;
        }
        
        /* Empty state styling */
        #emptyHistory {
            padding: 3rem 1rem;
        }
        
        #emptyHistory .feather-lg {
            opacity: 0.5;
        }
        
        /* Error states */
        .is-invalid {
            border-color: var(--bs-danger);
        }
        
        .is-invalid:focus {
            border-color: var(--bs-danger);
            box-shadow: 0 0 0 0.2rem rgba(var(--bs-danger-rgb), 0.25);
        }
        
        /* Success state for results */
        .alert-success {
            border-left: 4px solid var(--bs-success);
        }
        
        /* Loading spinner customization */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
        
        /* History card hover effects */
        .card-body:hover .btn-outline-secondary,
        .card-body:hover .btn-outline-danger {
            opacity: 1;
        }
        
        .btn-outline-secondary,
        .btn-outline-danger {
            opacity: 0.7;
            transition: opacity 0.2s ease-in-out;
        }
        
        /* URL input validation styling */
        .form-control.is-invalid ~ .form-text {
            color: var(--bs-danger);
        }
        
        /* Navbar brand styling */
        .navbar-brand {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
        }
        
        /* Hero section spacing */
        .hero-section {
            padding: 2rem 0;
        }
        
        /* Result section styling */
        #resultSection .alert {
            margin-bottom: 1.5rem;
        }
        
        /* Click count styling */
        #clickCount {
            margin-top: 0.5rem;
            font-size: 0.875rem;
        }
        
        /* History section styling */
        .history-header {
            border-bottom: 2px solid var(--bs-border-color);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        
        /* Accessibility improvements */
        .btn:focus,
        .form-control:focus {
            outline: none;
        }
        
        .btn:focus-visible,
        .form-control:focus-visible {
            outline: 2px solid var(--bs-primary);
            outline-offset: 2px;
        }
        
        /* Animation for result section appearing */
        #resultSection {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bs-dark);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--bs-secondary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--bs-light);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                <i data-feather="link-2" class="me-2"></i>
                Slink
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5">
        <!-- Hero Section -->
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="text-center mb-5">
                    <h1 class="display-4 fw-bold mb-3">Shorten Your URLs</h1>
                    <p class="lead text-muted">Transform long URLs into short, shareable links instantly</p>
                </div>

                <!-- URL Shortener Form -->
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <form id="shortenForm" class="mb-4">
                            <div class="mb-3">
                                <label for="urlInput" class="form-label">Enter your URL</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i data-feather="link" class="feather-sm"></i>
                                    </span>
                                    <input 
                                        type="url" 
                                        class="form-control form-control-lg" 
                                        id="urlInput" 
                                        placeholder="https://example.com/very-long-url"
                                        required
                                        aria-describedby="urlHelp"
                                    >
                                </div>
                                <div id="urlHelp" class="form-text">Enter a valid URL starting with http:// or https://</div>
                                <div id="urlError" class="text-danger mt-2 d-none" role="alert"></div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg w-100" id="shortenBtn">
                                <span class="btn-text">
                                    <i data-feather="scissors" class="feather-sm me-2"></i>
                                    Shorten URL
                                </span>
                                <span class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
                                <span class="loading-text d-none">Shortening...</span>
                            </button>
                        </form>

                        <!-- Result Section -->
                        <div id="resultSection" class="d-none">
                            <div class="alert alert-success d-flex align-items-center" role="alert">
                                <i data-feather="check-circle" class="feather-sm me-2 text-success"></i>
                                <div>
                                    <strong>Success!</strong> Your URL has been shortened.
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="shortUrl" class="form-label">Shortened URL</label>
                                <div class="input-group">
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="shortUrl" 
                                        readonly
                                        aria-label="Shortened URL"
                                    >
                                    <button class="btn btn-outline-secondary" type="button" id="copyBtn">
                                        <i data-feather="copy" class="feather-sm me-1"></i>
                                        Copy
                                    </button>
                                </div>
                            </div>

                            <!-- Click Count (if available) -->
                            <div id="clickCount" class="d-none">
                                <small class="text-muted">
                                    <i data-feather="bar-chart-2" class="feather-sm me-1"></i>
                                    Click count: <span id="clickCountValue">0</span>
                                </small>
                            </div>
                        </div>

                        <!-- Error Alert -->
                        <div id="errorAlert" class="alert alert-danger d-none" role="alert">
                            <i data-feather="alert-circle" class="feather-sm me-2"></i>
                            <span id="errorMessage"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="row justify-content-center mt-5">
            <div class="col-md-10 col-lg-8">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Recent Links</h3>
                    <button class="btn btn-outline-secondary btn-sm" id="clearHistoryBtn">
                        <i data-feather="trash-2" class="feather-sm me-1"></i>
                        Clear History
                    </button>
                </div>
                
                <div id="historyContainer">
                    <div id="emptyHistory" class="text-center text-muted py-5">
                        <i data-feather="inbox" class="feather-lg mb-3"></i>
                        <p>No shortened links yet. Create your first one above!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="copyToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i data-feather="check" class="feather-sm text-success me-2"></i>
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                URL copied to clipboard!
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        class UrlShortener {
            constructor() {
                this.storageKey = 'slink_history';
                this.maxHistoryItems = 50;
                
                this.initializeElements();
                this.bindEvents();
                this.loadHistory();
            }

            initializeElements() {
                // Form elements
                this.form = document.getElementById('shortenForm');
                this.urlInput = document.getElementById('urlInput');
                this.shortenBtn = document.getElementById('shortenBtn');
                this.btnText = this.shortenBtn.querySelector('.btn-text');
                this.btnSpinner = this.shortenBtn.querySelector('.spinner-border');
                this.btnLoadingText = this.shortenBtn.querySelector('.loading-text');

                // Result elements
                this.resultSection = document.getElementById('resultSection');
                this.shortUrlInput = document.getElementById('shortUrl');
                this.copyBtn = document.getElementById('copyBtn');
                this.clickCount = document.getElementById('clickCount');
                this.clickCountValue = document.getElementById('clickCountValue');

                // Error elements
                this.urlError = document.getElementById('urlError');
                this.errorAlert = document.getElementById('errorAlert');
                this.errorMessage = document.getElementById('errorMessage');

                // History elements
                this.historyContainer = document.getElementById('historyContainer');
                this.emptyHistory = document.getElementById('emptyHistory');
                this.clearHistoryBtn = document.getElementById('clearHistoryBtn');

                // Toast elements
                this.copyToast = new bootstrap.Toast(document.getElementById('copyToast'));
            }

            bindEvents() {
                this.form.addEventListener('submit', (e) => this.handleSubmit(e));
                this.copyBtn.addEventListener('click', () => this.copyToClipboard());
                this.clearHistoryBtn.addEventListener('click', () => this.clearHistory());
                this.urlInput.addEventListener('input', () => this.clearErrors());
            }

            async handleSubmit(e) {
                e.preventDefault();
                
                const url = this.urlInput.value.trim();
                
                if (!this.validateUrl(url)) {
                    return;
                }

                this.setLoading(true);
                this.clearErrors();
                this.hideResult();

                try {
                    const result = await this.shortenUrl(url);
                    this.displayResult(result, url);
                    this.saveToHistory(result, url);
                    this.loadHistory(); // Refresh history display
                } catch (error) {
                    console.error('URL shortening error:', error);
                    this.showError(error.message || 'Failed to shorten URL. Please try again.');
                } finally {
                    this.setLoading(false);
                }
            }

            validateUrl(url) {
                if (!url) {
                    this.showUrlError('Please enter a URL');
                    return false;
                }

                try {
                    const urlObj = new URL(url);
                    if (!['http:', 'https:'].includes(urlObj.protocol)) {
                        this.showUrlError('URL must start with http:// or https://');
                        return false;
                    }
                    return true;
                } catch {
                    this.showUrlError('Please enter a valid URL');
                    return false;
                }
            }

            async shortenUrl(url) {
                // Generate a simple hash-based short code for demonstration
                const shortCode = this.generateShortCode(url);
                const shortUrl = `https://slink.to/${shortCode}`;
                
                // Simulate API delay for better UX
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                return {
                    full_short_link: shortUrl,
                    short_link: shortUrl,
                    code: shortCode,
                    total_clicks: Math.floor(Math.random() * 100) // Random click count for demo
                };
            }

            generateShortCode(url) {
                // Simple hash function for demonstration
                let hash = 0;
                for (let i = 0; i < url.length; i++) {
                    const char = url.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32-bit integer
                }
                
                // Convert to base 36 and take first 6 characters
                const shortCode = Math.abs(hash).toString(36).substring(0, 6);
                return shortCode || 'abc123'; // Fallback
            }

            displayResult(result, originalUrl) {
                this.shortUrlInput.value = result.full_short_link;
                this.resultSection.classList.remove('d-none');

                // Show click count if available
                if (result.total_clicks !== undefined) {
                    this.clickCountValue.textContent = result.total_clicks;
                    this.clickCount.classList.remove('d-none');
                } else {
                    this.clickCount.classList.add('d-none');
                }

                // Scroll to result
                this.resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            async copyToClipboard() {
                try {
                    await navigator.clipboard.writeText(this.shortUrlInput.value);
                    this.copyToast.show();
                    
                    // Update button feedback
                    const originalIcon = this.copyBtn.innerHTML;
                    this.copyBtn.innerHTML = '<i data-feather="check" class="feather-sm me-1"></i>Copied!';
                    feather.replace();
                    
                    setTimeout(() => {
                        this.copyBtn.innerHTML = originalIcon;
                        feather.replace();
                    }, 2000);
                } catch (error) {
                    // Fallback for browsers that don't support clipboard API
                    this.shortUrlInput.select();
                    document.execCommand('copy');
                    this.copyToast.show();
                }
            }

            saveToHistory(result, originalUrl) {
                const history = this.getHistory();
                const newEntry = {
                    id: Date.now(),
                    original: originalUrl,
                    short: result.full_short_link,
                    code: result.code,
                    created: new Date().toISOString(),
                    clicks: result.total_clicks || 0
                };

                // Add to beginning and limit history size
                history.unshift(newEntry);
                const limitedHistory = history.slice(0, this.maxHistoryItems);
                
                localStorage.setItem(this.storageKey, JSON.stringify(limitedHistory));
            }

            getHistory() {
                try {
                    return JSON.parse(localStorage.getItem(this.storageKey) || '[]');
                } catch {
                    return [];
                }
            }

            loadHistory() {
                const history = this.getHistory();
                
                if (history.length === 0) {
                    this.historyContainer.innerHTML = '<div id="emptyHistory" class="text-center text-muted py-5"><i data-feather="inbox" class="feather-lg mb-3"></i><p>No shortened links yet. Create your first one above!</p></div>';
                } else {
                    this.historyContainer.innerHTML = history.map(entry => this.createHistoryItem(entry)).join('');
                }
                
                feather.replace();
                this.bindHistoryEvents();
            }

            createHistoryItem(entry) {
                const date = new Date(entry.created).toLocaleDateString();
                const time = new Date(entry.created).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="mb-2">
                                        <small class="text-muted">${date} at ${time}</small>
                                    </div>
                                    <div class="mb-2">
                                        <strong class="text-primary">${entry.short}</strong>
                                    </div>
                                    <div class="text-muted small text-truncate" title="${entry.original}">
                                        <i data-feather="arrow-up-right" class="feather-sm me-1"></i>
                                        ${entry.original}
                                    </div>
                                </div>
                                <div class="col-md-4 text-md-end">
                                    <div class="d-flex flex-column flex-md-row gap-2 justify-content-md-end">
                                        <button class="btn btn-outline-secondary btn-sm copy-history-btn" data-url="${entry.short}">
                                            <i data-feather="copy" class="feather-sm"></i>
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm delete-history-btn" data-id="${entry.id}">
                                            <i data-feather="trash-2" class="feather-sm"></i>
                                        </button>
                                    </div>
                                    ${entry.clicks > 0 ? `<small class="text-muted mt-2 d-block"><i data-feather="bar-chart-2" class="feather-sm me-1"></i>${entry.clicks} clicks</small>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            bindHistoryEvents() {
                // Copy buttons
                document.querySelectorAll('.copy-history-btn').forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        const url = e.currentTarget.dataset.url;
                        try {
                            await navigator.clipboard.writeText(url);
                            this.copyToast.show();
                            
                            const originalIcon = e.currentTarget.innerHTML;
                            e.currentTarget.innerHTML = '<i data-feather="check" class="feather-sm"></i>';
                            feather.replace();
                            
                            setTimeout(() => {
                                e.currentTarget.innerHTML = originalIcon;
                                feather.replace();
                            }, 2000);
                        } catch (error) {
                            console.error('Copy failed:', error);
                        }
                    });
                });

                // Delete buttons
                document.querySelectorAll('.delete-history-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        this.deleteHistoryItem(id);
                    });
                });
            }

            deleteHistoryItem(id) {
                const history = this.getHistory();
                const updatedHistory = history.filter(item => item.id !== id);
                localStorage.setItem(this.storageKey, JSON.stringify(updatedHistory));
                this.loadHistory();
            }

            clearHistory() {
                if (confirm('Are you sure you want to clear all history? This action cannot be undone.')) {
                    localStorage.removeItem(this.storageKey);
                    this.loadHistory();
                }
            }

            setLoading(loading) {
                if (loading) {
                    this.shortenBtn.disabled = true;
                    this.btnText.classList.add('d-none');
                    this.btnSpinner.classList.remove('d-none');
                    this.btnLoadingText.classList.remove('d-none');
                } else {
                    this.shortenBtn.disabled = false;
                    this.btnText.classList.remove('d-none');
                    this.btnSpinner.classList.add('d-none');
                    this.btnLoadingText.classList.add('d-none');
                }
            }

            showUrlError(message) {
                this.urlError.textContent = message;
                this.urlError.classList.remove('d-none');
                this.urlInput.classList.add('is-invalid');
            }

            showError(message) {
                this.errorMessage.textContent = message;
                this.errorAlert.classList.remove('d-none');
                
                // Scroll to error
                this.errorAlert.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            clearErrors() {
                this.urlError.classList.add('d-none');
                this.urlInput.classList.remove('is-invalid');
                this.errorAlert.classList.add('d-none');
            }

            hideResult() {
                this.resultSection.classList.add('d-none');
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new UrlShortener();
            // Initialize Feather icons
            feather.replace();
        });
    </script>
</body>
                </html>
